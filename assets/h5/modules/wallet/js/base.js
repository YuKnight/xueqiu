$(function(){FastClick.attach(document.body)}),function(e){function t(t){function i(o){if(70005==o.result_code||70006==o.result_code){var i=o.refresh_url||o.rebind_url;i&&xqBridge.redirect({url:"/broker/proxy?url="+encodeURIComponent(i),type:"PUSH",success:function(){"request"===t.name&&n(t)},cancel:function(){t.error&&e[t.error]&&e[t.error](o)}})}else 34106==o.result_code?xqBridge.verifyTelephone({type:"bind",success:function(){"request"===t.name&&n(t)},cancel:function(){t.error&&e[t.error]&&e[t.error](o)}}):s&&s(o)}var s=t.success;"request"===t.name&&(t.success=t.success?function(e){i(e)}:function(e){i(e)});var r=["success","cancel","error","complete","action"];_.each(r,function(n){if(t[n]){var i="cb"+ ++o,s=t[n];t[n]=i,e[i]=function(t){"string"==typeof t&&(t=decodeURIComponent(t),(/^\{.*\}$/.test(t)||/^\[.*\]$/.test(t))&&(t=$.parseJSON(t))),s(t),"action"!==n&&delete e[i]}}})}function n(n){if(_.isObject(n))if("setToolbar"===n.name&&n.buttons&&n.buttons.length){if(e.isSetToolbar)return!1;e.isSetToolbar=!0,_.each(n.buttons,function(e){t(e)})}else if("setRightNavigationButton"===n.name){if(e.isSetRightNavigationButton)return!1;e.isSetRightNavigationButton=!0,t(n)}else t(n);var o=document.createElement("iframe"),i=_.isObject(n)?JSON.stringify(n):n;console.log(i),o.setAttribute("src","js://"+encodeURIComponent(i)),document.documentElement.appendChild(o),o.parentNode.removeChild(o),o=null}var o=0;e.eventObj={},e.xqBridge={showLoading:function(){n("showloading")},hideLoading:function(){n("hideloading")},alert:function(e){e&&_.isObject(e)&&(e.name="alert"),n(e)},datePicker:function(e){e&&_.isObject(e)&&(e.name="datePicker"),n(e)},purchaseSnowCoin:function(e){e&&_.isObject(e)&&(e.name="purchaseSnowCoin"),n(e)},error:function(e){e&&_.isObject(e)&&(e.name="error"),n(e)},confirm:function(e){e&&_.isObject(e)&&(e.name="confirm"),n(e)},verifyTelephone:function(e){e&&_.isObject(e)&&(e.name="verifyTelephone"),n(e)},request:function(e){e&&_.isObject(e)&&(e.name="request",_.isUndefined(e.type)&&(e.type="GET")),n(e)},mergeRequests:function(e){e&&_.isObject(e)&&(e.name="mergeRequests"),n(e)},redirect:function(e){e&&_.isObject(e)&&(e.name="redirect"),n(e)},updateBrokerInfo:function(e){e&&_.isObject(e)&&(e.name="updateBroker"),n(e)},setToolbar:function(e){e&&_.isObject(e)&&(e.name="setToolbar"),n(e)},wxBind:function(e){e&&_.isObject(e)&&(e.name="wxBind"),n(e)},getAccessToken:function(e){e&&_.isObject(e)&&(e.name="getAccessToken"),n(e)},getWriteToken:function(e){e&&_.isObject(e)&&(e.name="getWriteToken"),n(e)},getUserInfo:function(e){e&&_.isObject(e)&&(e.name="getUserInfo"),n(e)},getAID:function(e){e&&_.isObject(e)&&(e.name="getAID"),n(e)},searchTCStock:function(e){e&&_.isObject(e)&&(e.name="searchTCStock"),n(e)},setToolbar:function(e){e&&_.isObject(e)&&(e.name="setToolbar"),n(e)},setRightNavigationButton:function(e){e&&_.isObject(e)&&(e.name="setRightNavigationButton"),n(e)},on:function(e,t){var n=eventObj[e];n?n.push(t):(n=[t],eventObj[e]=n)},off:function(e,t){if(t){var n=eventObj[e];n&&n.length&&(n=_.reject(n,function(e){return e==t}))}else delete eventObj[e]},trigger:function(e){var t=eventObj[e];t&&t.length&&_.each(t,function(e){e()})}},e.Util={bindBroker:function(e){xqBridge.redirect({url:"/broker/bind-list",type:"MODAL",success:e.success,cancel:e.cancel})},verifyPassword:function(e){xqBridge.redirect({url:e.url,type:"MODAL",success:e.success,cancel:e.cancel})},checkBindBroker:function(t){t.success&&t.error&&xqBridge.request({url:"/trade/securities/bound.json",success:function(n){n.result_data.length?(e.userInfo.brokerList=n.result_data,t.success(n)):t.success(!1)},error:function(e){t.error(e)}})},checkAndInit:function(e){var t=this;e.success&&e.cancel&&t.checkBindBroker({success:function(n){n?e.success(n):t.bindBroker({success:function(){t.checkAndInit(e)},error:function(t){e.cancel(t)}})},error:function(t){e.cancel(t)}})},getAndRefreshToken:function(e){xqBridge.getWriteToken({aid:e.aid,success:function(t){t?e.success&&e.success(t):xqBridge.redirect({url:"/broker/proxy?url="+encodeURIComponent(e.renew_url),type:"MODAL",success:function(){xqBridge.getWriteToken({aid:e.aid,success:function(t){e.success&&e.success(t)}})},cancel:function(t){e.error&&e.error(t)}})}})},parseParams:function(){var t=e.location.href,n=t.split("?"),o="";if(1===n.length)return{};o=_.last(n);var i=/([^&=]+)=?([^&]*)/g,s=/\+/g,r=function(e){return decodeURIComponent(e.replace(s," "))};o=decodeURIComponent(o);for(var c,u={};c=i.exec(o);){var a=r(c[1]),f=r(c[2]);"[]"===a.substring(a.length-2)?(a=a.substring(0,a.length-2),(u[a]||(u[a]=[])).push(f)):u[a]=f}return u},toast:{$toast:$(".toast"),show:function(e){var t=this;t.$toast.length>0?(t.$toast.html(e).show(),setTimeout(function(){t.$toast.hide()},3e3)):(t.$toast=$("<div class='toast'>"+e+"</div>"),$("body").append(t.$toast),t.$toast.css({backgroundColor:"rgba(0,0,0,0.6)",fontSize:"12px",borderRadius:"5px",position:"fixed",bottom:"15%",left:"15%",color:"#fff",padding:"10px",display:"none",zIndex:"9999",textAlign:"center",width:"70%",marginLeft:"-10px"}),t.$toast.show(),setTimeout(function(){t.$toast.hide()},3e3))},hide:function(){this.$toast.length>0&&this.$toast.hide()}},showError:function(t){var n=$(".error-tip"),o=t.length,i=14*o,s=i+20,r=$(e).scrollTop(),c=$(e).height();n.length||($("body").append('<div class="error-tip"></div>'),n=$(".error-tip")),n.css({width:s+"px","margin-left":"-"+s/2+"px",top:r+c/2+"px"}),n.text(t).show(),setTimeout(function(){n.hide()},1500)},setPress:function(e,t){var n=$("body"),o="touchstart",i="touchend",s="touchmove";!1 in document.documentElement&&(o="mousedown",i="mouseup",s="mousemove");var r=!1;n.on(o,e,function(){var e=$(this);setTimeout(function(){r||e.hasClass(t)||(e.addClass(t),e.data("nopress",!1))},100)}),n.on(s,e,function(){var e=$(this);r=!0,e.removeClass(t)}),n.on(i,e,function(){var e=$(this);setTimeout(function(){r=!1,e.removeClass(t)},200)}),-1==navigator.userAgent.indexOf("iPhone")&&n.on(i,function(){r=!1})},appVersion:function(){var e=5,t=navigator.userAgent.split(" ");if(t.length>=3){var n=t[2],o=n.split("-");e=parseFloat(o[0])}return e}},baseInit=function(){e.userInfo={},e.viewDidAppear=function(){},e.viewDidDisappear=function(){},xqBridge.getUserInfo({success:function(t){e.userInfo=t?t:{}},error:function(){}})},baseInit()}(window),$(function(){Number.prototype.formatMoney=function(e,t,n){var o=this,e=isNaN(e=Math.abs(e))?2:e,t=void 0==t?".":t,n=void 0==n?",":n,i=0>o?"-":"",s=parseInt(o=Math.abs(+o||0).toFixed(e))+"",r=(r=s.length)>3?r%3:0;return i+(r?s.substr(0,r)+n:"")+s.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?t+Math.abs(o-s).toFixed(e).slice(2):"")}});