define(function(require,exports,module){function e(e){xqBridge.hideLoading();var t="请求出错";"string"==typeof e?t=e:e&&e.error_description&&(t=e.error_description),Util.showError(t)}module.exports={init:function(){var e=this;this.setNavigationButton(),this.getBalanceInfo(),this.bindEvent(),xqBridge.getUserInfo({success:function(t){e.uid=t.uid}})},setNavigationButton:function(){xqBridge.setRightNavigationButton({title:"收支明细",action:function(){var e="/wallet/bill";xqBridge.redirect({url:e,type:"PUSH"})}})},getBalanceInfo:function(){var t=this;xqBridge.request({url:"/tc/snowpay/wallet/show.json",type:"GET",success:function(e){xqBridge.hideLoading();var i=((e.snow_money+e.snow_money_in)/100).toFixed(2),n=(e.snow_money/100).toFixed(2);$(".balance").html("¥"+i),$(".available-amount").html("¥"+n),t.available=n,0==n&&$("#submit").addClass("disabled")},error:function(t){xqBridge.hideLoading(),e(t)}})},checkWxBind:function(e){var t=this;xqBridge.request({url:"/account/bind/show.json",type:"POST",success:function(i){for(var n=i.oauthbind,c=!1,s=0;s<n.length;s++){var o=n[s];if("wc"==o[0]){c=!0,t.wxName=o[2],t.wxOpenId=o[1];break}}if(c)e&&e();else{var r="亲爱的球友您好，雪球钱包提现切换到了更加方便快捷的微信通道，首次提现需要您登录微信进行授权绑定账号。";xqBridge.confirm({title:"提现进行微信授权",message:r,cancel_button:"取消",success_button:"去授权",success:function(){xqBridge.wxBind({success:function(){t.checkWxBind(e)},error:function(){Util.showError("绑定失败")}})}})}}})},checkRealName:function(e){var t=this;xqBridge.request({url:"/cubes/consultants/show_by_uid.json",type:"GET",data:{uid:t.uid},success:function(t){switch(t.censor_status){case"new":xqBridge.alert({title:"实名认证",message:"亲爱的球友您好，您的实名认证正在审核中，请耐心等待审核结果。",button_title:"知道了",success:$.noop});break;case"invalid":xqBridge.confirm({title:"实名认证未通过",message:"您好，实名认证审核未通过，原因是"+t.censor_code+"。",cancel_button:"取消",success_button:"去认证",success:function(){xqBridge.redirect({type:"PUSH",url:"http://xueqiu.com/prove/list"})}});break;case"valid":e&&e()}},error:function(){xqBridge.hideLoading(),xqBridge.confirm({title:"完成实名认证",message:"亲爱的球友您好，根据国家相关法规，雪球钱包提现需要完成实名认证。",cancel_button:"取消",success_button:"去认证",success:function(){xqBridge.redirect({type:"PUSH",url:"http://xueqiu.com/prove/list"})}})}})},bindEvent:function(){var e=this;e.isBindEvent||(e.isBindEvent=!0,$("button").on("click",function(t){if(t.preventDefault(),Util.appVersion()<=8.1)return Util.showError("请升级App到最新版本"),!1;if($(this).hasClass("disabled"))return!1;var i=function(){var t="/wallet/withdraw?name="+encodeURIComponent(e.wxName)+"&amount="+e.available+"&openid="+e.wxOpenId;xqBridge.redirect({url:t,type:"PUSH"})};xqBridge.request({url:"/tc/snowpay/withdraw/can_withdraw.json",type:"GET",data:{},success:function(t){t.success?e.checkWxBind(i):e.checkRealName(function(){e.checkWxBind(i)})}})}),$("body").on("click",".available",function(e){e.preventDefault(),xqBridge.redirect({url:"http://xueqiu.com/law/balance",type:"PUSH"})}),window.viewDidAppear=function(){e.getBalanceInfo()})}}});