define(function(require,exports,module){function e(e){var t=setInterval(function(){e--,0==e?(clearInterval(t),$("#verify").text("发送验证码"),$("#verify").attr({backgound:"#fd7722",disabled:!1})):$("#verify").text(e+"s后重新获取")},1e3)}function t(e){var t=e.card_no.length-8,r=e.card_no.splice(4,t,"*".repeat(t));xqBridge.confirm({title:"提现信息确认",message:"姓名: "+e.real_name+"\n卡号: "+r+"\n金额: "+e.amount+"元\n手续费: 2元(雪球代付)",alignment:"left",success:function(){xqBridge.request({url:"/tc/snowpay/withdraw/apply.json",type:"POST",data:{verify_code:e.verify_code,real_name:$(".name").val(),card_no:e.card_no,amount:$(".cash-amount").val(),openBank:$(".default").text()},success:function(e){0==e.success?xqBridge.alert({message:e.message}):xqBridge.redirect({url:"/wallet/state?state=1",type:"PUSH"})},error:function(e){xqBridge.alert({message:e.error_description})}})},success_button:"确定",cancel_button:"取消"})}function r(){xqBridge.alert({message:"网络错误"})}String.prototype.splice=function(e,t,r){return this.substr(0,e)+r+this.substr(e+t)},String.prototype.repeat=function(e){return new Array(e+1).join(this)};var n=function(e){this.rules=e};n.prototype.validateAll=function(){for(var e in a)if(!a[e].submitskip&&$("."+e).length&&a[e].rule()!==!0)return Util.showError(a[e].rule()),!1;return!0},n.prototype.validate=function(e){return this.rules[e]?this.rules[e].rule():!0};var a={name:{rule:function(){var e=$(".name").val();return e?/^([\u4e00-\u9fa5]){2,7}$/.test(e)?!0:"请输入合法姓名":"姓名不能为空"}},"card-number":{rule:function(){var e=$(".card-number").val(),t=$(".card-number").data("card_no");return t||e?""==e||/[0-9]{4}[0-9]{8,11}[0-9]{4}/.test(e)?!0:"请输入正确位数的卡号":"请输入您的卡号"}},"default":{rule:function(){var e=$(".default").text();return"请选择银行"===e?"请选择银行":!0}},"cash-amount":{rule:function(){var e=$(".cash-amount").val();return e?!/^[0-9]{0,10}(.[0-9]{1,2})?$/.test(e)||parseInt(e)<=0?"请输入有效的提现金额":!0:"请输入提现金额"}},"verify-number":{rule:function(){var e=$(".verify-number").val();return e?/[0-9]{4,6}/.test(e)?!0:"请输入有效位数的验证码":"验证码不能为空"}}};module.exports={init:function(){this.getCashInfo()},getCashInfo:function(){xqBridge.request({url:"/tc/snowpay/withdraw/get_bind_info.json",type:"GET",success:function(e){if(""===e.real_name?$(".name").prop("disabled",!1):$(".name").val(e.real_name),e.card_no.length){var t=e.card_no.length-8,r=e.card_no.splice(4,t,"*".repeat(t));$(".card-number").attr("placeholder",r),$(".card-number").data("card_no",e.card_no)}var n=Util.parseParams();$("#phone-number").append(n.number.splice(3,4,"*".repeat(4))),n.snow_money.length&&$(".cash-amount").attr("placeholder","可提现金额"+parseFloat(n.snow_money/100).toFixed(2)+"元")},error:function(e){r(e)}})}},$("select").on("change",function(){var e=$("select option:selected").text();$(".default").css("color","#333"),$(".default").text(e)}),$("#verify").on("click",function(){var t=$(this);if(!t.is(":disabled")){var r=Util.parseParams();xqBridge.showLoading(),xqBridge.request({url:"/account/sms/send_verification_code.json",type:"POST",data:{telephone:r.number},success:function(){Util.toast.show("获取验证码成功"),t.attr("disabled",!0),e(60)},error:function(e){Util.toast.show(e.error_description),t.attr("disabled",!1),$("#verify").text("重新发送验证码")},complete:function(){xqBridge.hideLoading()}})}}),Util.setPress("#withdraw-cash","active"),$("#withdraw-cash").on("click",function(){var e=$(".verify-number").val(),r=new n(a);if(r.validateAll()){var i=$(".card-number").val();i=""===i?$(".card-number").data("card_no"):i,t({verify_code:e,real_name:$(".name").val(),card_no:i,amount:$(".cash-amount").val()})}})});