define(function(require,exports,module){var t=Util.parseParams();t&&"open"===t.jump&&(window.location.href="/broker/open-list");var e=require("template/trade/config-broker-list.js");module.exports={init:function(){var t=this;xqBridge.setRightNavigationButton({title:"开户",action:function(){xqBridge.trackEvent("secManage_open"),xqBridge.redirect({url:"/broker/open-list?from=trademanage",type:"PUSH",success:function(){t.init()},cancel:function(){t.init()}})}}),this.getData(),this.isBindEvent||this.bindEvent()},getData:function(){xqBridge.showLoading();var t="/tc/snowx/securities/bound.json";xqBridge.request({url:t,success:function(t){if(t.result_data&&t.result_data.length){var i=t.result_data.map(function(t){return"SUCCESS"!==t.status&&(t.trader_name+="(待添加)"),t});$(".brokers").html(e({data:{brokers:i}})).show()}else $(".brokers").hide()},error:function(){Util.showError("券商列表获取失败")},complete:function(){xqBridge.hideLoading()}})},bindEvent:function(){this.isBindEvent=!0,Util.setPress(".broker-list li .top","onpress"),Util.setPress(".bind-open","onpress");var t=this;$(".bind-open").on("click",function(){xqBridge.trackEvent("secManage_add"),xqBridge.redirect({url:"/broker/bind-list",type:"MODAL",success:function(){Util.appVersion()>=6.5&&xqBridge.updateBrokerList(),t.init()},cancel:function(){Util.appVersion()>=6.5&&xqBridge.updateBrokerList(),t.init()}})}),$(".brokers").on("click","li .top .left",function(){xqBridge.trackEvent("secManage_switch");var e=($(this).parent().data("tid"),$(this).parent().data("aid")),i=$(this).parent().data("status");return"SUCCESS"!==i?(Util.showError("请完成添加后再设置默认"),!1):(xqBridge.showLoading(),void xqBridge.request({url:"/tc/snowx/securities/default.json",type:"POST",data:{changetoaid:e},success:function(e){6e4==e.result_code?(Util.appVersion()>=6.5&&xqBridge.updateBrokerList(),t.init()):(xqBridge.hideLoading(),Util.showError("切换账号出错"))},error:function(){xqBridge.hideLoading(),Util.showError("切换账号出错")}}))}),$(".brokers").on("click","li .top .right",function(){xqBridge.trackEvent("secManage_delete");var e=$(this).parent().data("tid"),i=$(this).parent().data("aid"),r=$(this).parent().data("tname"),n="删除后您将无法通过雪球直接下单进行证券交易。";xqBridge.confirm({title:"确认删除"+r+"？",message:n,alignment:"left",success:function(){xqBridge.request({url:"/tc/snowx/unbind.json",type:"POST",data:{aid:i,tid:e},success:function(e){6e4==e.result_code?(Util.appVersion()>=6.5&&xqBridge.updateBrokerList(),t.init()):Util.showError(e.msg)},error:function(){Util.showError("解绑失败！")},complete:function(){}})},cancel:function(){}})})}}});